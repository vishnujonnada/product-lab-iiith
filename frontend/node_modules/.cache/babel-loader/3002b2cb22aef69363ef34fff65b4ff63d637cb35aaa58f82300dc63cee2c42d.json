{"ast":null,"code":"var _jsxFileName = \"/home/vishnapanyala/Desktop/myapp/src/components/annotate.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useCallback } from 'react';\nimport { Stage, Layer, Image, Rect, Transformer } from 'react-konva';\nimport useImage from 'use-image';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst AnnotateImage = _ref => {\n  _s();\n  let {\n    imageUrl,\n    classId = 0\n  } = _ref;\n  const [image] = useImage(imageUrl);\n  const [rectangles, setRectangles] = useState([]);\n  const [selectedId, selectShape] = useState(null);\n  const isDrawing = useRef(false);\n  const transformerRef = useRef();\n  const checkDeselect = useCallback(e => {\n    const clickedOnEmpty = e.target === e.target.getStage();\n    if (clickedOnEmpty) {\n      selectShape(null);\n    }\n  }, []);\n  const handleMouseDown = e => {\n    checkDeselect(e);\n    if (e.target === e.target.getStage()) {\n      isDrawing.current = true;\n      const pos = e.target.getPointerPosition();\n      setRectangles([...rectangles, {\n        id: rectangles.length,\n        x: pos.x,\n        y: pos.y,\n        width: 0,\n        height: 0\n      }]);\n    }\n  };\n  const handleMouseMove = e => {\n    if (!isDrawing.current) {\n      return;\n    }\n    const currentRect = rectangles[rectangles.length - 1];\n    const pos = e.target.getPointerPosition();\n    currentRect.width = pos.x - currentRect.x;\n    currentRect.height = pos.y - currentRect.y;\n    const newRectangles = rectangles.slice(0, rectangles.length - 1);\n    newRectangles.push(currentRect);\n    setRectangles(newRectangles);\n  };\n  const handleMouseUp = () => {\n    isDrawing.current = false;\n  };\n  const exportYoloAnnotations = () => {\n    const annotations = rectangles.map(rect => {\n      const x_center = (rect.x + rect.width / 2) / image.width;\n      const y_center = (rect.y + rect.height / 2) / image.height;\n      const width = rect.width / image.width;\n      const height = rect.height / image.height;\n      return `${classId} ${x_center} ${y_center} ${width} ${height}`;\n    });\n    console.log(annotations);\n    return annotations;\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Stage, {\n      width: window.innerWidth,\n      height: window.innerHeight,\n      onMouseDown: handleMouseDown,\n      onMousemove: handleMouseMove,\n      onMouseup: handleMouseUp,\n      onClick: checkDeselect,\n      onTouchStart: checkDeselect,\n      children: /*#__PURE__*/_jsxDEV(Layer, {\n        children: [/*#__PURE__*/_jsxDEV(Image, {\n          image: image\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 11\n        }, this), rectangles.map((rect, i) => /*#__PURE__*/_jsxDEV(React.Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Rect, {\n            x: rect.x,\n            y: rect.y,\n            width: rect.width,\n            height: rect.height,\n            stroke: \"red\",\n            strokeWidth: 2,\n            draggable: true,\n            onClick: e => {\n              e.cancelBubble = true;\n              selectShape(rect.id);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 15\n          }, this), rect.id === selectedId && /*#__PURE__*/_jsxDEV(Transformer, {\n            ref: transformerRef,\n            boundBoxFunc: (oldBox, newBox) => {\n              // limit resize\n              if (newBox.width < 5 || newBox.height < 5) {\n                return oldBox;\n              }\n              return newBox;\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 17\n          }, this)]\n        }, i, true, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: exportYoloAnnotations,\n      children: \"Export YOLO Annotations\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(AnnotateImage, \"qofR0EXqcAsUjcd6x1kPSjGTQCs=\", false, function () {\n  return [useImage];\n});\n_c = AnnotateImage;\nexport default AnnotateImage;\nvar _c;\n$RefreshReg$(_c, \"AnnotateImage\");","map":{"version":3,"names":["React","useState","useRef","useCallback","Stage","Layer","Image","Rect","Transformer","useImage","jsxDEV","_jsxDEV","Fragment","_Fragment","AnnotateImage","_ref","_s","imageUrl","classId","image","rectangles","setRectangles","selectedId","selectShape","isDrawing","transformerRef","checkDeselect","e","clickedOnEmpty","target","getStage","handleMouseDown","current","pos","getPointerPosition","id","length","x","y","width","height","handleMouseMove","currentRect","newRectangles","slice","push","handleMouseUp","exportYoloAnnotations","annotations","map","rect","x_center","y_center","console","log","children","window","innerWidth","innerHeight","onMouseDown","onMousemove","onMouseup","onClick","onTouchStart","fileName","_jsxFileName","lineNumber","columnNumber","i","stroke","strokeWidth","draggable","cancelBubble","ref","boundBoxFunc","oldBox","newBox","_c","$RefreshReg$"],"sources":["/home/vishnapanyala/Desktop/myapp/src/components/annotate.js"],"sourcesContent":["import React, { useState, useRef, useCallback } from 'react';\nimport { Stage, Layer, Image, Rect, Transformer } from 'react-konva';\nimport useImage from 'use-image';\n\nconst AnnotateImage = ({ imageUrl, classId = 0 }) => {\n  const [image] = useImage(imageUrl);\n  const [rectangles, setRectangles] = useState([]);\n  const [selectedId, selectShape] = useState(null);\n  const isDrawing = useRef(false);\n  const transformerRef = useRef();\n\n  const checkDeselect = useCallback((e) => {\n    const clickedOnEmpty = e.target === e.target.getStage();\n    if (clickedOnEmpty) {\n      selectShape(null);\n    }\n  }, []);\n\n  const handleMouseDown = (e) => {\n    checkDeselect(e);\n\n    if (e.target === e.target.getStage()) {\n      isDrawing.current = true;\n      const pos = e.target.getPointerPosition();\n      setRectangles([\n        ...rectangles,\n        {\n          id: rectangles.length,\n          x: pos.x,\n          y: pos.y,\n          width: 0,\n          height: 0,\n        },\n      ]);\n    }\n  };\n\n  const handleMouseMove = (e) => {\n    if (!isDrawing.current) {\n      return;\n    }\n    const currentRect = rectangles[rectangles.length - 1];\n    const pos = e.target.getPointerPosition();\n    currentRect.width = pos.x - currentRect.x;\n    currentRect.height = pos.y - currentRect.y;\n\n    const newRectangles = rectangles.slice(0, rectangles.length - 1);\n    newRectangles.push(currentRect);\n    setRectangles(newRectangles);\n  };\n\n  const handleMouseUp = () => {\n    isDrawing.current = false;\n  };\n\n  const exportYoloAnnotations = () => {\n    const annotations = rectangles.map((rect) => {\n      const x_center = (rect.x + rect.width / 2) / image.width;\n      const y_center = (rect.y + rect.height / 2) / image.height;\n      const width = rect.width / image.width;\n      const height = rect.height / image.height;\n      return `${classId} ${x_center} ${y_center} ${width} ${height}`;\n    });\n\n    console.log(annotations);\n    return annotations;\n  };\n\n  return (\n    <>\n      <Stage\n        width={window.innerWidth}\n        height={window.innerHeight}\n        onMouseDown={handleMouseDown}\n        onMousemove={handleMouseMove}\n        onMouseup={handleMouseUp}\n        onClick={checkDeselect}\n        onTouchStart={checkDeselect}\n      >\n        <Layer>\n          <Image image={image} />\n          {rectangles.map((rect, i) => (\n            <React.Fragment key={i}>\n              <Rect\n                x={rect.x}\n                y={rect.y}\n                width={rect.width}\n                height={rect.height}\n                stroke=\"red\"\n                strokeWidth={2}\n                draggable\n                onClick={(e) => {\n                  e.cancelBubble = true;\n                  selectShape(rect.id);\n                }}\n              />\n              {rect.id === selectedId && (\n                <Transformer\n                  ref={transformerRef}\n                  boundBoxFunc={(oldBox, newBox) => {\n                    // limit resize\n                    if (newBox.width < 5 || newBox.height < 5) {\n                      return oldBox;\n                    }\n                    return newBox;\n                  }}\n                />\n             \n              )}\n            </React.Fragment>\n          ))}\n        </Layer>\n      </Stage>\n      <button onClick={exportYoloAnnotations}>Export YOLO Annotations</button>\n    </>\n  );\n};\n\nexport default AnnotateImage;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}